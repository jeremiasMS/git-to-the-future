<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantalla 4: Wild West (1885) | Git to the Future</title>
  
  <!-- CSS Modular -->
  <link rel="stylesheet" href="../css/variables.css">
  <link rel="stylesheet" href="../css/components/base.css">
  <link rel="stylesheet" href="../css/components/branch-indicator.css">
  <link rel="stylesheet" href="../css/components/console.css">
  <link rel="stylesheet" href="../css/components/graph.css">
  <link rel="stylesheet" href="../css/components/navigation.css">
  
  <!-- GitGraph CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@gitgraph/js"></script>

  <style>
    /* Tema del Lejano Oeste */
    body {
      background: linear-gradient(135deg, #3e2723 0%, #1a1a2e 100%);
    }
    .header {
      border-bottom: 2px solid #a1887f;
    }
  </style>
</head>
<body class="screen-body">
  <!-- Header Principal de la App -->
  <header class="app-header">
    <a href="../index.html" style="text-decoration: none;">
      
      <h1 class="app-header__title">GIT TO THE FUTURE</h1>
    </a>
  </header>

  <!-- NavegaciÃ³n Superior -->
  <div id="navigationContainer"></div>

  <!-- Header de la Pantalla -->
  <header class="header">
    <div class="container">
      <div id="breadcrumbContainer"></div>
      <h1 class="text-gradient" style="color: #a1887f;">ğŸ¤  Pantalla 4: Wild West (1885)</h1>
      <p class="text-muted">El final Ã©pico: Doc en el Lejano Oeste, Clara, y el cierre de toda la saga de Back to the Future</p>
    </div>
  </header>

  <!-- Contenido Principal -->
  <main class="container" style="max-width: 1400px; margin: 0 auto; padding: var(--spacing-xl);">
    
    <!-- Historia / Contexto -->
        <section class="card card--accent" style="margin-bottom: var(--spacing-lg); border-color: #d32f2f;">
      <h2>ğŸ“– Historia: El Salvaje Oeste y Comandos Expertos</h2>
      <p>
        En <strong>1885</strong>, Doc conoce a Clara Clayton y debe enfrentar decisiones difÃ­ciles. 
        Esta pantalla final te enseÃ±arÃ¡ los comandos mÃ¡s poderosos y peligrosos de Git.
      </p>
      <p>
        Domina <strong>Git nivel experto</strong>:
      </p>
      <ul>
        <li><code>git stash</code> - ğŸ’¾ Guardar trabajo temporal sin commit</li>
        <li><code>git reset --soft</code> - âš ï¸ Deshacer commits manteniendo cambios</li>
        <li><code>git revert</code> - ğŸ”„ Deshacer cambios sin reescribir historia</li>
        <li><code>git commit</code> - Registrar la saga del Salvaje Oeste</li>
        <li><code>git merge</code> - FusiÃ³n final de todas las lÃ­neas temporales</li>
      </ul>
      <p class="text-muted" style="margin-top: var(--spacing-md);">
        <strong>ğŸ¯ Objetivo:</strong> Completar 13 ejercicios dominando los comandos mÃ¡s avanzados de Git.
      </p>
      <div class="badge badge--danger" style="margin-top: var(--spacing-md); background: linear-gradient(135deg, #c62828, #e53935);">
        âš ï¸ Nivel Experto - Comandos que pueden reescribir la historia
      </div>
    </section>

    <!-- Progreso de Ejercicios -->
    <div id="exerciseProgress"></div>

    <!-- Instrucciones del Ejercicio Actual -->
    <div id="exerciseInstructions"></div>

    <!-- Grid de Dos Columnas -->
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
      
      <!-- Columna Izquierda: GrÃ¡fico -->
      <div class="graph" style="border-color: #a1887f;">
        <div class="branch-indicator" style="background: linear-gradient(135deg, #8d6e63, #a1887f);">
          <span class="branch-indicator__label">ğŸ¤  Era:</span>
          <span class="branch-indicator__value" id="currentBranchIndicator">1885 (Wild West)</span>
        </div>
        
        <h2 class="graph__title" style="color: #a1887f;">ğŸ LÃ­neas Temporales del Oeste</h2>
        <p class="graph__description">El historial mÃ¡s antiguo de todos</p>
        
        <div class="graph__canvas" id="gitGraph"></div>

        <!-- Info del Oeste -->
        <div class="graph__info" style="border-color: #a1887f; background: rgba(161, 136, 127, 0.1);">
          <div class="graph__info-item">
            <span class="graph__info-label">ğŸ—“ï¸ AÃ±o:</span>
            <span class="graph__info-value" style="color: #a1887f;">1885</span>
          </div>
          <div class="graph__info-item">
            <span class="graph__info-label">ğŸ¯ Objetivo:</span>
            <span class="graph__info-value">Rescatar al Doc</span>
          </div>
          <div class="graph__info-item">
            <span class="graph__info-label">âš¡ Combustible:</span>
            <span class="graph__info-value">Locomotora de vapor</span>
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Consola -->
      <div class="console" style="border-color: #a1887f;">
        <h2 class="console__title" style="color: #a1887f;">ğŸ–¥ï¸ TelÃ©grafo Temporal</h2>
        <p class="console__description">ComunicaciÃ³n con el DeLorean en 1885</p>

        <!-- Output de la Consola -->
        <div class="console__output" id="consoleOutput">
          <div class="console__output-line console__output-line--info">
            <span class="prompt">$</span> ğŸ“§ Carta del Doc: "Querido Marty, estoy atrapado en 1885..."
          </div>
          <div class="console__output-line console__output-line--info">
            <span class="prompt">$</span> Marty: "Â¡Tengo que rescatar al Doc del Lejano Oeste!" ğŸ¤ 
          </div>
        </div>

        <!-- Botones de Comandos RÃ¡pidos -->
        <div class="console__commands">
          <button class="console__cmd-btn" data-command="status">status</button>
          <button class="console__cmd-btn" data-command="stash">stash</button>
          <button class="console__cmd-btn" data-command="stash list">stash list</button>
          <button class="console__cmd-btn" data-command="stash pop">stash pop</button>
          <button class="console__cmd-btn" data-command="branch 1885">branch 1885</button>
          <button class="console__cmd-btn" data-command="checkout 1885">checkout 1885</button>
        </div>

        <!-- Input de Comando -->
        <div class="console__input">
          <span class="console__input-prompt" style="color: #a1887f;">git $</span>
          <input 
            type="text" 
            class="console__input-field" 
            id="commandInput" 
            placeholder="Comandos del oeste..."
            autocomplete="off"
          >
          <button class="console__execute-btn" id="executeBtn" style="background: #a1887f;">â–¶</button>
        </div>

        <!-- Botones Especiales -->
        <div class="console__special-buttons">
          <button class="console__special-btn console__special-btn--reset" id="resetBtn">
            ğŸ”„ Reiniciar
          </button>
          <button class="console__special-btn console__special-btn--demo" id="hintBtn">
            ğŸ’¡ Pista
          </button>
        </div>
      </div>

    </div>

    <!-- Mapa Temporal -->
    <section class="card card--primary" style="margin-top: var(--spacing-lg);">
      <h3>ğŸ—ºï¸ Mapa de Viajes Temporales Completo</h3>
      <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-lg) 0; flex-wrap: wrap;">
        <div class="text-center" style="flex: 1; min-width: 150px;">
          <div style="font-size: 48px;">ğŸ¤ </div>
          <strong style="color: #a1887f;">1885</strong>
          <p class="text-muted text-sm">Lejano Oeste</p>
        </div>
        <div style="font-size: 24px; color: var(--color-accent);">â†’</div>
        <div class="text-center" style="flex: 1; min-width: 150px;">
          <div style="font-size: 48px;">ğŸ¸</div>
          <strong style="color: #2196f3;">1955</strong>
          <p class="text-muted text-sm">Rock & Roll</p>
        </div>
        <div style="font-size: 24px; color: var(--color-accent);">â†’</div>
        <div class="text-center" style="flex: 1; min-width: 150px;">
          <div style="font-size: 48px;">ğŸ“¼</div>
          <strong style="color: #ff9100;">1985</strong>
          <p class="text-muted text-sm">Presente</p>
        </div>
        <div style="font-size: 24px; color: var(--color-accent);">â†’</div>
        <div class="text-center" style="flex: 1; min-width: 150px;">
          <div style="font-size: 48px;">ğŸš€</div>
          <strong style="color: #7c4dff;">2015</strong>
          <p class="text-muted text-sm">Futuro</p>
        </div>
      </div>
    </section>

    <!-- Ayuda Adicional -->
    <section class="card card--secondary" style="margin-top: var(--spacing-lg);">
      <h3>ğŸ“ Comandos Avanzados</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-md);">
        <div>
          <strong style="color: #a1887f;">git stash</strong>
          <p class="text-muted text-sm">Guarda cambios sin commit temporalmente</p>
          <code class="text-xs">Ãštil cuando necesitas cambiar de rama rÃ¡pidamente</code>
        </div>
        <div>
          <strong style="color: #a1887f;">git stash pop</strong>
          <p class="text-muted text-sm">Recupera los Ãºltimos cambios guardados</p>
          <code class="text-xs">Restaura tu trabajo en progreso</code>
        </div>
        <div>
          <strong style="color: #a1887f;">git stash list</strong>
          <p class="text-muted text-sm">Muestra todos los stashes guardados</p>
          <code class="text-xs">Puedes tener mÃºltiples stashes</code>
        </div>
        <div>
          <strong style="color: #a1887f;">git branch -d [rama]</strong>
          <p class="text-muted text-sm">Elimina una rama que ya no necesitas</p>
          <code class="text-xs">Limpia tu historial</code>
        </div>
      </div>
    </section>

    <!-- Congratulations Message -->
    <section class="card card--accent" style="margin-top: var(--spacing-lg); border-color: #4caf50; background: rgba(76, 175, 80, 0.1);">
      <h3 style="color: #4caf50;">ğŸ‰ Â¡Ãšltima Pantalla!</h3>
      <p>
        Esta es la Ãºltima pantalla de ejercicios interactivos. Al completarla, desbloquearÃ¡s el 
        <strong>Demo Completo de Back to the Future</strong> donde verÃ¡s todos los conceptos integrados 
        en una visualizaciÃ³n completa de la trilogÃ­a.
      </p>
      <p class="text-muted">
        Â¡Vamos Doc! El futuro nos espera... ğŸš—âš¡ğŸ’¨
      </p>
    </section>

  </main>

  <!-- Footer -->
  <footer class="text-center text-muted" style="padding: var(--spacing-xl); margin-top: var(--spacing-xl);">
    <p>ğŸš—âš¡ Git to the Future - Aprende Git usando Back to the Future</p>
    <p class="text-sm">Pantalla 4 de 4 | Wild West (1885)</p>
  </footer>

  <!-- JavaScript Modular -->
  <script type="module">
    import { 
      GitGraphController, 
      ConsoleController, 
      ScreenController,
      ExerciseValidator,
      SCREEN_EXERCISES,
      UIController,
      Logger 
    } from '../js/modules/index.js';

    Logger.log('Iniciando Pantalla 4: Wild West');

    const graph = new GitGraphController('gitGraph');
    const consoleCtrl = new ConsoleController('consoleOutput', 'commandInput', graph);
    const validator = new ExerciseValidator(consoleCtrl, graph);
    const ui = new UIController();
    const screenCtrl = new ScreenController();

    // Inicializar con escenario del Lejano Oeste
    graph.initialize();

    // Configurar ejercicios
    validator.setExercises(SCREEN_EXERCISES.screen4);

    // Renderizar UI
    screenCtrl.renderNavigation('navigationContainer');
    screenCtrl.renderBreadcrumb('breadcrumbContainer');

    const firstExercise = validator.getCurrentExercise();
    if (firstExercise) {
      ui.showExerciseInstructions(firstExercise, 'exerciseInstructions');
      ui.updateExerciseProgress(0, SCREEN_EXERCISES.screen4.length, 'exerciseProgress');
    }

    // Interceptar comandos
    const originalExecute = consoleCtrl.executeCommand.bind(consoleCtrl);
    consoleCtrl.executeCommand = function(commandString) {
      originalExecute(commandString);

      const parts = commandString.trim().toLowerCase().split(' ');
      const command = parts[0] === 'git' ? parts[1] : parts[0];
      const args = parts[0] === 'git' ? parts.slice(2) : parts.slice(1);

      const result = validator.validateCommand(command, args);
      
      if (result.valid) {
        ui.showNotification(result.message, 'success');
        const nextResult = validator.nextExercise();
        
        if (nextResult.completed) {
          ui.showNotification('ğŸ‰ Â¡Has completado todas las pantallas de Git to the Future!', 'success', 5000);
          ui.createConfetti();
          screenCtrl.completeScreen(4);
          
          setTimeout(() => {
            ui.showCompletionModal('Wild West (1885)', () => {
              // Desbloquear demo final
              screenCtrl.completeScreen(4);
              ui.showNotification('ğŸ¬ Demo completo desbloqueado!', 'success', 3000);
              setTimeout(() => {
                screenCtrl.navigateTo(5); // Demo
              }, 1000);
            });
          }, 2000);
        } else {
          ui.updateExerciseProgress(
            validator.currentExerciseIndex,
            SCREEN_EXERCISES.screen4.length,
            'exerciseProgress'
          );
          ui.showExerciseInstructions(nextResult.exercise, 'exerciseInstructions');
        }
      }
    };

    // Event listeners
    document.getElementById('executeBtn').addEventListener('click', () => {
      const input = document.getElementById('commandInput');
      const command = input.value.trim();
      if (command) {
        consoleCtrl.executeCommand(command);
        input.value = '';
      }
    });

    document.getElementById('commandInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('executeBtn').click();
      }
    });

    document.querySelectorAll('.console__cmd-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('commandInput').value = btn.getAttribute('data-command');
        document.getElementById('commandInput').focus();
      });
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      if (confirm('Â¿Reiniciar la pantalla?')) {
        location.reload();
      }
    });

    document.getElementById('hintBtn').addEventListener('click', () => {
      const exercise = validator.getCurrentExercise();
      if (exercise && exercise.hint) {
        ui.showNotification(exercise.hint, 'info', 5000);
      }
    });

    // Actualizar indicador
    const originalCheckout = graph.checkout.bind(graph);
    graph.checkout = function(branchName) {
      const result = originalCheckout(branchName);
      if (result) {
        const year = branchName === '1885' ? '1885 (Wild West)' : branchName;
        ui.updateBranchIndicator(year);
      }
      return result;
    };

    Logger.log('Pantalla 4 lista - Lejano Oeste activado ğŸ¤ ');
  </script>

</body>
</html>
