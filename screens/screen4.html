<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pantalla 4: Wild West (1885) | Git to the Future</title>

    <!-- CSS Modular -->
    <link rel="stylesheet" href="../css/variables.css" />
    <link rel="stylesheet" href="../css/components/base.css" />
    <link rel="stylesheet" href="../css/components/branch-indicator.css" />
    <link rel="stylesheet" href="../css/components/console.css" />
    <link rel="stylesheet" href="../css/components/graph.css" />
    <link rel="stylesheet" href="../css/components/navigation.css" />
    <link rel="stylesheet" href="../css/screens.css" />

    <!-- GitGraph CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@gitgraph/js"></script>
  </head>
  <body class="screen-body screen-wildwest">
    <!-- Botón de Volver -->
    <a href="../index-menu.html" title="Volver al menú principal">
      <img
        src="../assets/fonts/img/Back.png"
        alt="Volver"
        style="
          position: fixed;
          top: 20px;
          left: 20px;
          height: 40px;
          cursor: pointer;
          z-index: 1000;
        "
      />
    </a>
    <!-- Header Principal de la App -->
    <header class="app-header">
      <a href="../index.html" style="text-decoration: none">
        <h1 class="app-header__title">GIT TO THE FUTURE</h1>
      </a>
    </header>

    <!-- Navegación Superior -->
    <div id="navigationContainer"></div>

    <!-- Header de la Pantalla -->
    <header class="header">
      <div class="container">
        <div id="breadcrumbContainer"></div>
        <h1 class="text-gradient" style="color: #a1887f">
          🤠 Pantalla 4: Wild West (1885)
        </h1>
        <p class="text-muted">
          El final épico: Doc en el Lejano Oeste, Clara, y el cierre de toda la
          saga de Back to the Future
        </p>
      </div>
    </header>

    <!-- Contenido Principal -->
    <main
      class="container"
      style="max-width: 1400px; margin: 0 auto; padding: var(--spacing-xl)"
    >
      <!-- Historia / Contexto -->
      <section
        class="card card--accent"
        style="margin-bottom: var(--spacing-lg); border-color: #d32f2f"
      >
        <h2>📖 Historia: El Salvaje Oeste y Comandos Expertos</h2>
        <p>
          En <strong>1885</strong>, Doc conoce a Clara Clayton y debe enfrentar
          decisiones difíciles. Esta pantalla final te enseñará los comandos más
          poderosos y peligrosos de Git.
        </p>
        <p>Domina <strong>Git nivel experto</strong>:</p>
        <ul>
          <li>
            <code>git stash</code> - 💾 Guardar trabajo temporal sin commit
          </li>
          <li>
            <code>git reset --soft</code> - ⚠️ Deshacer commits manteniendo
            cambios
          </li>
          <li>
            <code>git revert</code> - 🔄 Deshacer cambios sin reescribir
            historia
          </li>
          <li><code>git commit</code> - Registrar la saga del Salvaje Oeste</li>
          <li>
            <code>git merge</code> - Fusión final de todas las líneas temporales
          </li>
        </ul>
        <p class="text-muted" style="margin-top: var(--spacing-md)">
          <strong>🎯 Objetivo:</strong> Completar 13 ejercicios dominando los
          comandos más avanzados de Git.
        </p>
        <div
          class="badge badge--danger"
          style="
            margin-top: var(--spacing-md);
            background: linear-gradient(135deg, #c62828, #e53935);
          "
        >
          ⚠️ Nivel Experto - Comandos que pueden reescribir la historia
        </div>
      </section>

      <!-- Progreso de Ejercicios -->
      <div id="exerciseProgress"></div>

      <!-- Instrucciones del Ejercicio Actual -->
      <div id="exerciseInstructions"></div>

      <!-- Grid de Dos Columnas -->
      <div
        class="grid"
        style="
          grid-template-columns: 1fr 1fr;
          gap: var(--spacing-lg);
          margin-top: var(--spacing-lg);
        "
      >
        <!-- Columna Izquierda: Gráfico -->
        <div class="graph" style="border-color: #a1887f">
          <div
            class="branch-indicator"
            style="background: linear-gradient(135deg, #8d6e63, #a1887f)"
          >
            <span class="branch-indicator__label">🤠 Era:</span>
            <span class="branch-indicator__value" id="currentBranchIndicator"
              >1885 (Wild West)</span
            >
          </div>

          <h2 class="graph__title" style="color: #a1887f">
            🐎 Líneas Temporales del Oeste
          </h2>
          <p class="graph__description">El historial más antiguo de todos</p>

          <div class="graph__canvas" id="gitGraph"></div>

          <!-- Info del Oeste -->
          <div
            class="graph__info"
            style="border-color: #a1887f; background: rgba(161, 136, 127, 0.1)"
          >
            <div class="graph__info-item">
              <span class="graph__info-label">🗓️ Año:</span>
              <span class="graph__info-value" style="color: #a1887f">1885</span>
            </div>
            <div class="graph__info-item">
              <span class="graph__info-label">🎯 Objetivo:</span>
              <span class="graph__info-value">Rescatar al Doc</span>
            </div>
            <div class="graph__info-item">
              <span class="graph__info-label">⚡ Combustible:</span>
              <span class="graph__info-value">Locomotora de vapor</span>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Consola -->
        <div class="console" style="border-color: #a1887f">
          <h2 class="console__title" style="color: #a1887f">
            🖥️ Telégrafo Temporal
          </h2>
          <p class="console__description">
            Comunicación con el DeLorean en 1885
          </p>

          <!-- Output de la Consola -->
          <div class="console__output" id="consoleOutput">
            <div class="console__output-line console__output-line--info">
              <span class="prompt">$</span> 📧 Carta del Doc: "Querido Marty,
              estoy atrapado en 1885..."
            </div>
            <div class="console__output-line console__output-line--info">
              <span class="prompt">$</span> Marty: "¡Tengo que rescatar al Doc
              del Lejano Oeste!" 🤠
            </div>
          </div>

          <!-- Botones de Comandos Rápidos -->
          <div class="console__commands">
            <button class="console__cmd-btn" data-command="status">
              status
            </button>
            <button class="console__cmd-btn" data-command="stash">stash</button>
            <button class="console__cmd-btn" data-command="stash list">
              stash list
            </button>
            <button class="console__cmd-btn" data-command="stash pop">
              stash pop
            </button>
            <button class="console__cmd-btn" data-command="branch 1885">
              branch 1885
            </button>
            <button class="console__cmd-btn" data-command="checkout 1885">
              checkout 1885
            </button>
            <button class="console__cmd-btn" data-command="merge">merge</button>
            <button class="console__cmd-btn" data-command="pull">pull</button>
            <button class="console__cmd-btn" data-command="push">push</button>
          </div>

          <!-- Input de Comando -->
          <div class="console__input">
            <span class="console__input-prompt" style="color: #a1887f"
              >git $</span
            >
            <input
              type="text"
              class="console__input-field"
              id="commandInput"
              placeholder="Comandos del oeste..."
              autocomplete="off"
            />
            <button
              class="console__execute-btn"
              id="executeBtn"
              style="background: #a1887f"
            >
              ▶
            </button>
          </div>

          <!-- Botones Especiales -->
          <div class="console__special-buttons">
            <button
              class="console__special-btn console__special-btn--reset"
              id="resetBtn"
            >
              🔄 Reiniciar
            </button>
            <button
              class="console__special-btn console__special-btn--demo"
              id="hintBtn"
            >
              💡 Pista
            </button>
          </div>
        </div>
      </div>

      <!-- Mapa Temporal -->
      <section class="card card--primary" style="margin-top: var(--spacing-lg)">
        <h3>🗺️ Mapa de Viajes Temporales Completo</h3>
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg) 0;
            flex-wrap: wrap;
          "
        >
          <div class="text-center" style="flex: 1; min-width: 150px">
            <div style="font-size: 48px">🤠</div>
            <strong style="color: #a1887f">1885</strong>
            <p class="text-muted text-sm">Lejano Oeste</p>
          </div>
          <div style="font-size: 24px; color: var(--color-accent)">→</div>
          <div class="text-center" style="flex: 1; min-width: 150px">
            <div style="font-size: 48px">🎸</div>
            <strong style="color: #2196f3">1955</strong>
            <p class="text-muted text-sm">Rock & Roll</p>
          </div>
          <div style="font-size: 24px; color: var(--color-accent)">→</div>
          <div class="text-center" style="flex: 1; min-width: 150px">
            <div style="font-size: 48px">📼</div>
            <strong style="color: #ff9100">1985</strong>
            <p class="text-muted text-sm">Presente</p>
          </div>
          <div style="font-size: 24px; color: var(--color-accent)">→</div>
          <div class="text-center" style="flex: 1; min-width: 150px">
            <div style="font-size: 48px">🚀</div>
            <strong style="color: #7c4dff">2015</strong>
            <p class="text-muted text-sm">Futuro</p>
          </div>
        </div>
      </section>

      <!-- Ayuda Adicional -->
      <section
        class="card card--secondary"
        style="margin-top: var(--spacing-lg)"
      >
        <h3>🎓 Comandos Avanzados</h3>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
          "
        >
          <div>
            <strong style="color: #a1887f">git stash</strong>
            <p class="text-muted text-sm">
              Guarda cambios sin commit temporalmente
            </p>
            <code class="text-xs"
              >Útil cuando necesitas cambiar de rama rápidamente</code
            >
          </div>
          <div>
            <strong style="color: #a1887f">git stash pop</strong>
            <p class="text-muted text-sm">
              Recupera los últimos cambios guardados
            </p>
            <code class="text-xs">Restaura tu trabajo en progreso</code>
          </div>
          <div>
            <strong style="color: #a1887f">git stash list</strong>
            <p class="text-muted text-sm">
              Muestra todos los stashes guardados
            </p>
            <code class="text-xs">Puedes tener múltiples stashes</code>
          </div>
          <div>
            <strong style="color: #a1887f">git branch -d [rama]</strong>
            <p class="text-muted text-sm">
              Elimina una rama que ya no necesitas
            </p>
            <code class="text-xs">Limpia tu historial</code>
          </div>
        </div>
      </section>

      <!-- Congratulations Message -->
      <section
        class="card card--accent"
        style="
          margin-top: var(--spacing-lg);
          border-color: #4caf50;
          background: rgba(76, 175, 80, 0.1);
        "
      >
        <h3 style="color: #4caf50">🎉 ¡Última Pantalla!</h3>
        <p>
          Esta es la última pantalla de ejercicios interactivos. Al completarla,
          desbloquearás el
          <strong>Demo Completo de Back to the Future</strong> donde verás todos
          los conceptos integrados en una visualización completa de la trilogía.
        </p>
        <p class="text-muted">¡Vamos Doc! El futuro nos espera... 🚗⚡💨</p>
      </section>
    </main>

    <!-- Footer -->
    <footer
      class="text-center text-muted"
      style="padding: var(--spacing-xl); margin-top: var(--spacing-xl)"
    >
      <p>🚗⚡ Git to the Future - Aprende Git usando Back to the Future</p>
      <p class="text-sm">Pantalla 4 de 4 | Wild West (1885)</p>
    </footer>

    <!-- JavaScript sin módulos ES6 -->
    <script src="../js/git-bttf-standalone.js"></script>
    <script>
      // Definir ejercicios para Screen 4
      SCREEN_EXERCISES.screen4 = [
        {
          id: 1,
          title: 'Preparar rescate en el Oeste',
          description:
            'Inicializa un repositorio para documentar la misión de rescate de Doc',
          expectedCommand: 'git init',
          successMessage: '🚗 Máquina temporal preparada para 1885',
          hint: "Usa 'git init' para comenzar",
        },
        {
          id: 2,
          title: 'Crear rama del Oeste',
          description:
            "Crea una rama llamada '1885' para la línea temporal del Lejano Oeste",
          expectedCommand: 'git branch 1885',
          successMessage: '🤠 Línea temporal del Oeste creada',
          hint: "Usa 'git branch 1885'",
        },
        {
          id: 3,
          title: 'Viajar al Lejano Oeste',
          description: "Cambia a la rama '1885' para comenzar el rescate",
          expectedCommand: 'git checkout 1885',
          successMessage: '🏜️ Has llegado al Lejano Oeste - ¡Encuentra a Doc!',
          hint: "Usa 'git checkout 1885'",
        },
        {
          id: 4,
          title: 'Guardar trabajo temporal',
          description:
            'Doc está en peligro, guarda tu trabajo actual con stash',
          expectedCommand: 'git stash',
          successMessage:
            '📦 Trabajo guardado temporalmente para la emergencia',
          hint: "Usa 'git stash' para guardar cambios no confirmados",
        },
        {
          id: 5,
          title: 'Rescatar a Doc',
          description: 'Agrega archivos del rescate y haz un commit urgente',
          expectedCommand: 'git add .',
          successMessage: '🆘 Preparando operación de rescate',
          hint: "Usa 'git add .' para preparar archivos",
        },
        {
          id: 6,
          title: 'Confirmar el rescate',
          description: 'Registra el rescate exitoso de Doc con un commit',
          expectedCommand: 'git commit',
          successMessage: '🎯 ¡Doc rescatado exitosamente!',
          hint: 'Usa \'git commit -m "mensaje"\'',
        },
        {
          id: 7,
          title: 'Recuperar trabajo guardado',
          description: 'Recupera el trabajo que guardaste con stash pop',
          expectedCommand: 'git stash pop',
          successMessage: '🔄 Trabajo temporal recuperado',
          hint: "Usa 'git stash pop' para recuperar cambios guardados",
        },
        {
          id: 8,
          title: 'Sincronizar con otras líneas temporales',
          description:
            'Descarga cambios del repositorio remoto con git pull antes de regresar',
          expectedCommand: 'git pull',
          successMessage: '📡 Cambios de otras líneas temporales integrados',
          hint: "Usa 'git pull' para descargar cambios del remoto",
        },
        {
          id: 9,
          title: 'Regresar al presente',
          description: 'Vuelve al presente (rama main) con Doc a salvo',
          expectedCommand: 'git checkout main',
          successMessage: '🏠 ¡Regreso exitoso al presente con Doc!',
          hint: "Usa 'git checkout main'",
        },
        {
          id: 10,
          title: 'Fusionar líneas temporales',
          description: 'Fusiona la rama del Oeste para completar la saga',
          expectedCommand: 'git merge 1885',
          successMessage:
            '🎉 ¡Todas las líneas temporales restauradas! Saga completada',
          hint: "Usa 'git merge 1885' para fusionar la rama",
        },
      ];

      document.addEventListener('DOMContentLoaded', function () {
        Logger.log('Iniciando Pantalla 4: Wild West');

        const graph = new GitGraphController('gitGraph');
        const consoleCtrl = new ConsoleController(
          'consoleOutput',
          'commandInput',
          graph
        );
        const validator = new ExerciseValidator(consoleCtrl, graph);
        const ui = new UIController();
        const screenCtrl = new ScreenController();

        // Configurar ejercicios
        validator.setExercises(SCREEN_EXERCISES.screen4);
        consoleCtrl.setValidator(validator);

        // Renderizar UI
        screenCtrl.renderNavigation('navigationContainer');
        screenCtrl.renderBreadcrumb('breadcrumbContainer');

        const firstExercise = validator.getCurrentExercise();
        if (firstExercise) {
          ui.showExerciseInstructions(firstExercise, 'exerciseInstructions');
          ui.updateExerciseProgress(
            0,
            SCREEN_EXERCISES.screen4.length,
            'exerciseProgress'
          );
        }

        // Interceptar comandos para validación
        const originalExecute = consoleCtrl.executeCommand.bind(consoleCtrl);
        consoleCtrl.executeCommand = function (commandString) {
          const cmd = commandString.trim().toLowerCase();

          // Comandos de ayuda no necesitan validación
          if (
            cmd === 'hint' ||
            cmd === 'ayuda' ||
            cmd === 'help' ||
            cmd === 'clear'
          ) {
            originalExecute(commandString);
            return;
          }

          originalExecute(commandString);

          const parts = cmd.split(' ');
          const command = parts[0] === 'git' ? parts[1] : parts[0];
          const args = parts[0] === 'git' ? parts.slice(2) : parts.slice(1);

          const result = validator.validateCommand(command, args);

          if (result.valid) {
            ui.showNotification(result.message, 'success');
            const nextResult = validator.nextExercise();

            if (nextResult.completed) {
              ui.showNotification(
                '🎉 ¡Has completado todas las pantallas de Git to the Future!',
                'success',
                5000
              );
              ui.createConfetti();
              screenCtrl.completeScreen(4);

              setTimeout(() => {
                ui.showCompletionModal('Wild West (1885)', () => {
                  // Desbloquear demo final
                  ui.showNotification(
                    '🎬 Demo completo desbloqueado!',
                    'success',
                    3000
                  );
                  setTimeout(() => {
                    window.location.href = '../index-menu.html';
                  }, 1000);
                });
              }, 2000);
            } else {
              ui.updateExerciseProgress(
                validator.currentExerciseIndex,
                SCREEN_EXERCISES.screen4.length,
                'exerciseProgress'
              );
              ui.showExerciseInstructions(
                nextResult.exercise,
                'exerciseInstructions'
              );
            }
          } else if (result.suggestion) {
            ui.showNotification(result.suggestion, 'info', 4000);
          }
        };

        // Event listeners
        const executeCommand = () => {
          const input = document.getElementById('commandInput');
          const command = input.value.trim();
          if (command) {
            consoleCtrl.executeCommand(command);
            input.value = '';
          }
        };

        document
          .getElementById('executeBtn')
          .addEventListener('click', executeCommand);
        document
          .getElementById('commandInput')
          .addEventListener('keypress', (e) => {
            if (e.key === 'Enter') executeCommand();
          });

        document.querySelectorAll('.console__cmd-btn').forEach((btn) => {
          btn.addEventListener('click', () => {
            const command = btn.getAttribute('data-command');
            document.getElementById('commandInput').value = command;
            document.getElementById('commandInput').focus();
          });
        });

        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
          resetBtn.addEventListener('click', () => {
            if (
              confirm(
                '¿Estás seguro de reiniciar? Perderás todo el progreso de esta pantalla.'
              )
            ) {
              consoleCtrl.resetAll();
              validator.reset();
              ui.showExerciseInstructions(
                SCREEN_EXERCISES.screen4[0],
                'exerciseInstructions'
              );
              ui.updateExerciseProgress(
                0,
                SCREEN_EXERCISES.screen4.length,
                'exerciseProgress'
              );
              ui.showNotification('🔄 Pantalla reiniciada', 'info');
            }
          });
        }

        const hintBtn = document.getElementById('hintBtn');
        if (hintBtn) {
          hintBtn.addEventListener('click', () => {
            const exercise = validator.getCurrentExercise();
            if (exercise) {
              ui.showNotification(`💡 ${exercise.hint}`, 'warning', 6000);
            }
          });
        }

        // Actualizar indicador de rama
        const originalCheckout = graph.checkout.bind(graph);
        graph.checkout = function (branchName) {
          const result = originalCheckout(branchName);
          if (result) {
            const displayName =
              branchName === '1885'
                ? '1885 (Wild West)'
                : branchName === 'main'
                ? 'main (1985)'
                : branchName;
            ui.updateBranchIndicator(displayName);
          }
          return result;
        };

        Logger.log(
          'Pantalla 4 inicializada correctamente - Lejano Oeste activado 🤠'
        );
      });
    </script>
  </body>
</html>
