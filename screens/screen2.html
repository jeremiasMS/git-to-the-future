<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantalla 2: Time Travel (2015) | Git to the Future</title>
  
  <!-- CSS Modular -->
  <link rel="stylesheet" href="../css/variables.css">
  <link rel="stylesheet" href="../css/components/base.css">
  <link rel="stylesheet" href="../css/components/branch-indicator.css">
  <link rel="stylesheet" href="../css/components/console.css">
  <link rel="stylesheet" href="../css/components/graph.css">
  <link rel="stylesheet" href="../css/components/navigation.css">
  
  <!-- GitGraph CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@gitgraph/js"></script>
</head>
<body class="screen-body">
  <!-- Navegación Superior -->
  <div id="navigationContainer"></div>

  <!-- Header de la Pantalla -->
  <header class="header">
    <div class="container">
      <div id="breadcrumbContainer"></div>
      <h1 class="text-gradient">🚀 Pantalla 2: Time Travel (2015)</h1>
      <p class="text-muted">Marty y Doc viajan al futuro para prevenir que el hijo de Marty sea arrestado</p>
    </div>
  </header>

  <!-- Contenido Principal -->
  <main class="container" style="max-width: 1400px; margin: 0 auto; padding: var(--spacing-xl);">
    
    <!-- Historia / Contexto -->
    <section class="card card--accent" style="margin-bottom: var(--spacing-lg);">
      <h2>📖 Historia: Viaje al Futuro</h2>
      <p>
        Es el año <strong>1985</strong> y Marty ha logrado regresar del pasado. Pero el Doc aparece en el DeLorean 
        desde el <strong>futuro (2015)</strong> con noticias alarmantes: ¡el hijo de Marty está en problemas!
      </p>
      <p>
        En esta pantalla aprenderás sobre <strong>git checkout</strong> - el comando que te permite viajar entre 
        diferentes ramas (líneas temporales):
      </p>
      <ul>
        <li><code>git checkout [rama]</code> - Cambiar de rama (viajar en el tiempo)</li>
        <li><code>git checkout -b [rama]</code> - Crear y cambiar a una nueva rama</li>
        <li>Entender cómo Git te permite moverse entre diferentes estados del código</li>
        <li>Practicar viajes entre múltiples líneas temporales</li>
      </ul>
      <div class="badge badge--warning" style="margin-top: var(--spacing-md);">
        ⚠️ Recuerda: git checkout te permite viajar entre ramas, pero ten cuidado de no perder cambios sin hacer commit
      </div>
    </section>

    <!-- Progreso de Ejercicios -->
    <div id="exerciseProgress"></div>

    <!-- Instrucciones del Ejercicio Actual -->
    <div id="exerciseInstructions"></div>

    <!-- Grid de Dos Columnas -->
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
      
      <!-- Columna Izquierda: Gráfico -->
      <div class="graph">
        <div class="branch-indicator">
          <span class="branch-indicator__label">📍 Línea Temporal:</span>
          <span class="branch-indicator__value" id="currentBranchIndicator">main (1985)</span>
        </div>
        
        <h2 class="graph__title">🌌 Viajes Temporales</h2>
        <p class="graph__description">Observa cómo te mueves entre diferentes líneas temporales</p>
        
        <div class="graph__canvas" id="gitGraph"></div>

        <!-- Leyenda de Ramas -->
        <div class="graph__legend">
          <div class="graph__legend-item">
            <div class="graph__legend-color graph__legend-color--master"></div>
            <span>1985 (main)</span>
          </div>
          <div class="graph__legend-item">
            <div class="graph__legend-color graph__legend-color--secondary"></div>
            <span>2015 (futuro)</span>
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Consola -->
      <div class="console">
        <h2 class="console__title">🖥️ Panel de Control del DeLorean</h2>
        <p class="console__description">Configura el circuito temporal para tu viaje</p>

        <!-- Output de la Consola -->
        <div class="console__output" id="consoleOutput">
          <div class="console__output-line console__output-line--info">
            <span class="prompt">$</span> Doc: "¡Marty! Debemos viajar al futuro, al año 2015!" 🚗⚡
          </div>
          <div class="console__output-line console__output-line--info">
            <span class="prompt">$</span> Usa git checkout para viajar entre líneas temporales
          </div>
        </div>

        <!-- Botones de Comandos Rápidos -->
        <div class="console__commands">
          <button class="console__cmd-btn" data-command="status">status</button>
          <button class="console__cmd-btn" data-command="branch">branch</button>
          <button class="console__cmd-btn" data-command="branch 2015">branch 2015</button>
          <button class="console__cmd-btn" data-command="checkout 2015">checkout 2015</button>
          <button class="console__cmd-btn" data-command="checkout main">checkout main</button>
          <button class="console__cmd-btn" data-command="commit -m 'mensaje'">commit</button>
        </div>

        <!-- Input de Comando -->
        <div class="console__input">
          <span class="console__input-prompt">git $</span>
          <input 
            type="text" 
            class="console__input-field" 
            id="commandInput" 
            placeholder="Escribe tu comando aquí..."
            autocomplete="off"
          >
          <button class="console__execute-btn" id="executeBtn">▶</button>
        </div>

        <!-- Botones Especiales -->
        <div class="console__special-buttons">
          <button class="console__special-btn console__special-btn--reset" id="resetBtn">
            🔄 Reiniciar
          </button>
          <button class="console__special-btn console__special-btn--demo" id="hintBtn">
            💡 Pista
          </button>
        </div>
      </div>

    </div>

    <!-- Timeline Visual -->
    <section class="card card--primary" style="margin-top: var(--spacing-lg);">
      <h3>🕐 Cronología de Viajes</h3>
      <div style="display: flex; justify-content: space-around; align-items: center; padding: var(--spacing-lg) 0;">
        <div class="text-center">
          <div style="font-size: 48px;">📅</div>
          <strong>1985</strong>
          <p class="text-muted text-sm">Presente Original</p>
        </div>
        <div style="font-size: 32px; color: var(--color-accent);">→</div>
        <div class="text-center">
          <div style="font-size: 48px;">🚀</div>
          <strong>2015</strong>
          <p class="text-muted text-sm">Futuro</p>
        </div>
        <div style="font-size: 32px; color: var(--color-accent);">→</div>
        <div class="text-center">
          <div style="font-size: 48px;">🔙</div>
          <strong>1985</strong>
          <p class="text-muted text-sm">Regreso</p>
        </div>
      </div>
    </section>

    <!-- Ayuda Adicional -->
    <section class="card card--secondary" style="margin-top: var(--spacing-lg);">
      <h3>🎓 Comandos de esta Pantalla</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-md);">
        <div>
          <strong>git branch [nombre]</strong>
          <p class="text-muted text-sm">Crea una nueva línea temporal (rama)</p>
          <code class="text-xs">Ejemplo: git branch 2015</code>
        </div>
        <div>
          <strong>git checkout [rama]</strong>
          <p class="text-muted text-sm">Viaja a otra línea temporal existente</p>
          <code class="text-xs">Ejemplo: git checkout 2015</code>
        </div>
        <div>
          <strong>git checkout -b [rama]</strong>
          <p class="text-muted text-sm">Crea y viaja a una nueva rama en un solo paso</p>
          <code class="text-xs">Ejemplo: git checkout -b 2015</code>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="text-center text-muted" style="padding: var(--spacing-xl); margin-top: var(--spacing-xl);">
    <p>🚗⚡ Git to the Future - Aprende Git usando Back to the Future</p>
    <p class="text-sm">Pantalla 2 de 4 | Time Travel (2015)</p>
  </footer>

  <!-- JavaScript Modular -->
  <script type="module">
    import { 
      GitGraphController, 
      ConsoleController, 
      ScreenController,
      ExerciseValidator,
      SCREEN_EXERCISES,
      UIController,
      Logger 
    } from '../js/modules/index.js';

    Logger.log('Iniciando Pantalla 2: Time Travel');

    const graph = new GitGraphController('gitGraph');
    const consoleCtrl = new ConsoleController('consoleOutput', 'commandInput', graph);
    const validator = new ExerciseValidator(consoleCtrl, graph);
    const ui = new UIController();
    const screenCtrl = new ScreenController();

    // Inicializar con repositorio base
    graph.initialize();
    graph.commit('1985 - Presente');
    consoleCtrl.state.initialized = true;
    ui.updateBranchIndicator('main (1985)');

    // Configurar ejercicios de la pantalla 2
    validator.setExercises(SCREEN_EXERCISES.screen2);

    // Renderizar UI
    screenCtrl.renderNavigation('navigationContainer');
    screenCtrl.renderBreadcrumb('breadcrumbContainer');

    const firstExercise = validator.getCurrentExercise();
    if (firstExercise) {
      ui.showExerciseInstructions(firstExercise, 'exerciseInstructions');
      ui.updateExerciseProgress(0, SCREEN_EXERCISES.screen2.length, 'exerciseProgress');
    }

    // Interceptar comandos para validación
    const originalExecute = consoleCtrl.executeCommand.bind(consoleCtrl);
    consoleCtrl.executeCommand = function(commandString) {
      originalExecute(commandString);

      const parts = commandString.trim().toLowerCase().split(' ');
      const command = parts[0] === 'git' ? parts[1] : parts[0];
      const args = parts[0] === 'git' ? parts.slice(2) : parts.slice(1);

      const result = validator.validateCommand(command, args);
      
      if (result.valid) {
        ui.showNotification(result.message, 'success');
        const nextResult = validator.nextExercise();
        
        if (nextResult.completed) {
          ui.showNotification('🎉 ¡Has dominado los viajes temporales con git checkout!', 'success', 5000);
          ui.createConfetti();
          screenCtrl.completeScreen(2);
          
          setTimeout(() => {
            ui.showCompletionModal('Time Travel (2015)', () => {
              screenCtrl.navigateTo(3);
            });
          }, 2000);
        } else {
          ui.updateExerciseProgress(
            validator.currentExerciseIndex,
            SCREEN_EXERCISES.screen2.length,
            'exerciseProgress'
          );
          ui.showExerciseInstructions(nextResult.exercise, 'exerciseInstructions');
        }
      }
    };

    // Event listeners
    document.getElementById('executeBtn').addEventListener('click', () => {
      const input = document.getElementById('commandInput');
      const command = input.value.trim();
      if (command) {
        consoleCtrl.executeCommand(command);
        input.value = '';
      }
    });

    document.getElementById('commandInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('executeBtn').click();
      }
    });

    document.querySelectorAll('.console__cmd-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('commandInput').value = btn.getAttribute('data-command');
        document.getElementById('commandInput').focus();
      });
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      if (confirm('¿Reiniciar la pantalla?')) {
        location.reload();
      }
    });

    document.getElementById('hintBtn').addEventListener('click', () => {
      const exercise = validator.getCurrentExercise();
      if (exercise && exercise.hint) {
        ui.showNotification(exercise.hint, 'info', 5000);
      }
    });

    // Actualizar indicador en checkout
    const originalCheckout = graph.checkout.bind(graph);
    graph.checkout = function(branchName) {
      const result = originalCheckout(branchName);
      if (result) {
        const year = branchName === '2015' ? '2015' : '1985';
        ui.updateBranchIndicator(`${branchName} (${year})`);
      }
      return result;
    };

    Logger.log('Pantalla 2 lista');
  </script>

</body>
</html>
