<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pantalla 2: Time Travel (2015) | Git to the Future</title>

    <!-- CSS Modular -->
    <link rel="stylesheet" href="../css/variables.css" />
    <link rel="stylesheet" href="../css/components/base.css" />
    <link rel="stylesheet" href="../css/components/branch-indicator.css" />
    <link rel="stylesheet" href="../css/components/console.css" />
    <link rel="stylesheet" href="../css/components/graph.css" />
    <link rel="stylesheet" href="../css/components/navigation.css" />

    <!-- GitGraph CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@gitgraph/js"></script>
  </head>
  <body class="screen-body">
    <!-- BotÃ³n de Volver -->
    <a href="../index-menu.html" title="Volver al menÃº principal">
      <img
        src="../assets/fonts/img/Back.png"
        alt="Volver"
        style="
          position: fixed;
          top: 20px;
          left: 20px;
          height: 40px;
          cursor: pointer;
          z-index: 1000;
        "
      />
    </a>
    <!-- Header Principal de la App -->
    <header class="app-header">
      <a href="../index.html" style="text-decoration: none">
        <h1 class="app-header__title">GIT TO THE FUTURE</h1>
      </a>
    </header>

    <!-- NavegaciÃ³n Superior -->
    <div id="navigationContainer"></div>

    <!-- Header de la Pantalla -->
    <header class="header">
      <div class="container">
        <div id="breadcrumbContainer"></div>
        <h1 class="text-gradient">ğŸš€ Pantalla 2: Time Travel (2015)</h1>
        <p class="text-muted">
          Viaja al futuro, enfrenta la paradoja de Biff y el almanaque
          deportivo, y prepara el viaje a 1885
        </p>
      </div>
    </header>

    <!-- Contenido Principal -->
    <main
      class="container"
      style="max-width: 1400px; margin: 0 auto; padding: var(--spacing-xl)"
    >
      <!-- Historia / Contexto -->
      <section
        class="card card--accent"
        style="margin-bottom: var(--spacing-lg)"
      >
        <h2>ğŸ“– Historia: Viaje al Futuro y la DistopÃ­a de Biff (2015)</h2>
        <p>
          Doc regresa del <strong>futuro (2015)</strong> y lleva a Marty y
          Jennifer para resolver problemas familiares. Pero el viejo Biff roba
          el DeLorean, viaja a <strong>1955</strong> y le da un almanaque
          deportivo a su yo joven, creando un
          <strong>1985 distÃ³pico</strong> donde es millonario. Marty debe
          recuperar el almanaque y arreglar la lÃ­nea temporal, pero un rayo
          envÃ­a a Doc accidentalmente a 1885.
        </p>
        <p>
          En esta pantalla trabajarÃ¡s con <strong>ramas mÃ¡s complejas</strong>:
        </p>
        <ul>
          <li>
            <code>git commit</code> - Registrar eventos del futuro y la distopÃ­a
          </li>
          <li>
            <code>git branch</code> - Crear la rama "biff-paradise" (lÃ­nea
            corrupta)
          </li>
          <li><code>git checkout</code> - Navegar entre lÃ­neas temporales</li>
          <li>Aprender a trabajar con mÃºltiples commits y ramas</li>
        </ul>
        <p class="text-muted" style="margin-top: var(--spacing-md)">
          <strong>ğŸ¯ Objetivo:</strong> Completar 6 ejercicios que cubren la
          segunda pelÃ­cula de BTTF.
        </p>
      </section>

      <!-- Progreso de Ejercicios -->
      <div id="exerciseProgress"></div>

      <!-- Instrucciones del Ejercicio Actual -->
      <div id="exerciseInstructions"></div>

      <!-- Grid de Dos Columnas -->
      <div
        class="grid"
        style="
          grid-template-columns: 1fr 1fr;
          gap: var(--spacing-lg);
          margin-top: var(--spacing-lg);
        "
      >
        <!-- Columna Izquierda: GrÃ¡fico -->
        <div class="graph">
          <div class="branch-indicator">
            <span class="branch-indicator__label">ğŸ“ LÃ­nea Temporal:</span>
            <span class="branch-indicator__value" id="currentBranchIndicator"
              >main (1985)</span
            >
          </div>

          <h2 class="graph__title">ğŸŒŒ Viajes Temporales</h2>
          <p class="graph__description">
            Observa cÃ³mo te mueves entre diferentes lÃ­neas temporales
          </p>

          <div class="graph__canvas" id="gitGraph"></div>

          <!-- Leyenda de Ramas -->
          <div class="graph__legend">
            <div class="graph__legend-item">
              <div
                class="graph__legend-color graph__legend-color--master"
              ></div>
              <span>1985 (main)</span>
            </div>
            <div class="graph__legend-item">
              <div
                class="graph__legend-color graph__legend-color--secondary"
              ></div>
              <span>2015 (futuro)</span>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Consola -->
        <div class="console">
          <h2 class="console__title">ğŸ–¥ï¸ Panel de Control del DeLorean</h2>
          <p class="console__description">
            Configura el circuito temporal para tu viaje
          </p>

          <!-- Output de la Consola -->
          <div class="console__output" id="consoleOutput">
            <div class="console__output-line console__output-line--info">
              <span class="prompt">$</span> Doc: "Â¡Marty! Debemos viajar al
              futuro, al aÃ±o 2015!" ğŸš—âš¡
            </div>
            <div class="console__output-line console__output-line--info">
              <span class="prompt">$</span> Usa git checkout para viajar entre
              lÃ­neas temporales
            </div>
          </div>

          <!-- Botones de Comandos RÃ¡pidos -->
          <div class="console__commands">
            <button class="console__cmd-btn" data-command="status">
              status
            </button>
            <button class="console__cmd-btn" data-command="branch">
              branch
            </button>
            <button class="console__cmd-btn" data-command="branch 2015">
              branch 2015
            </button>
            <button class="console__cmd-btn" data-command="checkout 2015">
              checkout 2015
            </button>
            <button class="console__cmd-btn" data-command="checkout main">
              checkout main
            </button>
            <button class="console__cmd-btn" data-command="commit -m 'mensaje'">
              commit
            </button>
            <button class="console__cmd-btn" data-command="merge">merge</button>
            <button class="console__cmd-btn" data-command="pull">pull</button>
            <button class="console__cmd-btn" data-command="push">push</button>
          </div>

          <!-- Input de Comando -->
          <div class="console__input">
            <span class="console__input-prompt">git $</span>
            <input
              type="text"
              class="console__input-field"
              id="commandInput"
              placeholder="Escribe tu comando aquÃ­..."
              autocomplete="off"
            />
            <button class="console__execute-btn" id="executeBtn">â–¶</button>
          </div>

          <!-- Botones Especiales -->
          <div class="console__special-buttons">
            <button
              class="console__special-btn console__special-btn--reset"
              id="resetBtn"
            >
              ğŸ”„ Reiniciar
            </button>
            <button
              class="console__special-btn console__special-btn--demo"
              id="hintBtn"
            >
              ğŸ’¡ Pista
            </button>
          </div>
        </div>
      </div>

      <!-- Timeline Visual -->
      <section class="card card--primary" style="margin-top: var(--spacing-lg)">
        <h3>ğŸ• CronologÃ­a de Viajes</h3>
        <div
          style="
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: var(--spacing-lg) 0;
          "
        >
          <div class="text-center">
            <div style="font-size: 48px">ğŸ“…</div>
            <strong>1985</strong>
            <p class="text-muted text-sm">Presente Original</p>
          </div>
          <div style="font-size: 32px; color: var(--color-accent)">â†’</div>
          <div class="text-center">
            <div style="font-size: 48px">ğŸš€</div>
            <strong>2015</strong>
            <p class="text-muted text-sm">Futuro</p>
          </div>
          <div style="font-size: 32px; color: var(--color-accent)">â†’</div>
          <div class="text-center">
            <div style="font-size: 48px">ğŸ”™</div>
            <strong>1985</strong>
            <p class="text-muted text-sm">Regreso</p>
          </div>
        </div>
      </section>

      <!-- Ayuda Adicional -->
      <section
        class="card card--secondary"
        style="margin-top: var(--spacing-lg)"
      >
        <h3>ğŸ“ Comandos de esta Pantalla</h3>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
          "
        >
          <div>
            <strong>git branch [nombre]</strong>
            <p class="text-muted text-sm">
              Crea una nueva lÃ­nea temporal (rama)
            </p>
            <code class="text-xs">Ejemplo: git branch 2015</code>
          </div>
          <div>
            <strong>git checkout [rama]</strong>
            <p class="text-muted text-sm">
              Viaja a otra lÃ­nea temporal existente
            </p>
            <code class="text-xs">Ejemplo: git checkout 2015</code>
          </div>
          <div>
            <strong>git checkout -b [rama]</strong>
            <p class="text-muted text-sm">
              Crea y viaja a una nueva rama en un solo paso
            </p>
            <code class="text-xs">Ejemplo: git checkout -b 2015</code>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer
      class="text-center text-muted"
      style="padding: var(--spacing-xl); margin-top: var(--spacing-xl)"
    >
      <p>ğŸš—âš¡ Git to the Future - Aprende Git usando Back to the Future</p>
      <p class="text-sm">Pantalla 2 de 4 | Time Travel (2015)</p>
    </footer>

    <!-- JavaScript sin mÃ³dulos ES6 -->
    <script src="../js/git-bttf-standalone.js"></script>
    <script>
      // Definir ejercicios para Screen 2
      SCREEN_EXERCISES.screen2 = [
        {
          id: 1,
          title: 'Preparar el viaje al futuro',
          description:
            'Inicializa un repositorio para documentar el viaje temporal a 2015',
          expectedCommand: 'git init',
          successMessage: 'ğŸš— El DeLorean estÃ¡ listo para el viaje a 2015',
          hint: "Usa 'git init' para inicializar el repositorio",
        },
        {
          id: 2,
          title: 'Crear rama temporal para 2015',
          description:
            "Crea una nueva rama llamada '2015' para documentar el futuro",
          expectedCommand: 'git branch 2015',
          successMessage: "ğŸš€ LÃ­nea temporal '2015' creada",
          hint: "Usa 'git branch 2015' para crear la nueva rama",
        },
        {
          id: 3,
          title: 'Viajar al futuro (2015)',
          description: "Cambia a la rama '2015' para explorar el futuro",
          expectedCommand: 'git checkout 2015',
          successMessage: 'âš¡ Â¡Has llegado a 2015! Bienvenido al futuro',
          hint: "Usa 'git checkout 2015' para cambiar a esa rama",
        },
        {
          id: 4,
          title: 'Documentar cambios en 2015',
          description: 'Agrega archivos que documenten la situaciÃ³n en 2015',
          expectedCommand: 'git add .',
          successMessage: 'ğŸ“„ Cambios del futuro documentados',
          hint: "Usa 'git add .' para agregar todos los archivos",
        },
        {
          id: 5,
          title: 'Crear commit del futuro',
          description: 'Registra un commit documentando los eventos en 2015',
          expectedCommand: 'git commit',
          successMessage: 'â° Eventos de 2015 registrados en la historia',
          hint: 'Usa \'git commit -m "mensaje"\' para crear el commit',
        },
        {
          id: 6,
          title: 'Sincronizar con la lÃ­nea temporal remota',
          description:
            'EnvÃ­a tus cambios al repositorio remoto usando git push',
          expectedCommand: 'git push',
          successMessage: 'ğŸ“¡ Cambios enviados a la lÃ­nea temporal remota',
          hint: "Usa 'git push' para enviar tus commits al repositorio remoto",
        },
        {
          id: 7,
          title: 'Regresar al presente',
          description: 'Vuelve a la rama principal para regresar a 1985',
          expectedCommand: 'git checkout main',
          successMessage: 'ğŸ  Has regresado al presente. Â¡MisiÃ³n cumplida!',
          hint: "Usa 'git checkout main' para volver al presente",
        },
      ];

      document.addEventListener('DOMContentLoaded', function () {
        Logger.log('Iniciando Pantalla 2: Time Travel');

        const graph = new GitGraphController('gitGraph');
        const consoleCtrl = new ConsoleController(
          'consoleOutput',
          'commandInput',
          graph
        );
        const validator = new ExerciseValidator(consoleCtrl, graph);
        const ui = new UIController();
        const screenCtrl = new ScreenController();

        // Configurar ejercicios de la pantalla 2
        validator.setExercises(SCREEN_EXERCISES.screen2);

        // Renderizar UI
        screenCtrl.renderNavigation('navigationContainer');
        screenCtrl.renderBreadcrumb('breadcrumbContainer');

        const firstExercise = validator.getCurrentExercise();
        if (firstExercise) {
          ui.showExerciseInstructions(firstExercise, 'exerciseInstructions');
          ui.updateExerciseProgress(
            0,
            SCREEN_EXERCISES.screen2.length,
            'exerciseProgress'
          );
        }

        // Interceptar comandos para validaciÃ³n
        const originalExecute = consoleCtrl.executeCommand.bind(consoleCtrl);
        consoleCtrl.executeCommand = function (commandString) {
          const cmd = commandString.trim().toLowerCase();

          // Comandos de ayuda no necesitan validaciÃ³n
          if (
            cmd === 'hint' ||
            cmd === 'ayuda' ||
            cmd === 'help' ||
            cmd === 'clear'
          ) {
            originalExecute(commandString);
            return;
          }

          originalExecute(commandString);

          const parts = cmd.split(' ');
          const command = parts[0] === 'git' ? parts[1] : parts[0];
          const args = parts[0] === 'git' ? parts.slice(2) : parts.slice(1);

          const result = validator.validateCommand(command, args);

          if (result.valid) {
            ui.showNotification(result.message, 'success');
            const nextResult = validator.nextExercise();

            if (nextResult.completed) {
              ui.showNotification(
                'ğŸ‰ Â¡Has dominado los viajes temporales con git checkout!',
                'success',
                5000
              );
              ui.createConfetti();
              screenCtrl.completeScreen(2);

              setTimeout(() => {
                ui.showCompletionModal('Time Travel (2015)', () => {
                  screenCtrl.navigateTo(3);
                });
              }, 2000);
            } else {
              ui.updateExerciseProgress(
                validator.currentExerciseIndex,
                SCREEN_EXERCISES.screen2.length,
                'exerciseProgress'
              );
              ui.showExerciseInstructions(
                nextResult.exercise,
                'exerciseInstructions'
              );
            }
          } else if (result.suggestion) {
            ui.showNotification(result.suggestion, 'info', 4000);
          }
        };

        // Event listeners
        const executeCommand = () => {
          const input = document.getElementById('commandInput');
          const command = input.value.trim();
          if (command) {
            consoleCtrl.executeCommand(command);
            input.value = '';
          }
        };

        document
          .getElementById('executeBtn')
          .addEventListener('click', executeCommand);
        document
          .getElementById('commandInput')
          .addEventListener('keypress', (e) => {
            if (e.key === 'Enter') executeCommand();
          });

        document.querySelectorAll('.console__cmd-btn').forEach((btn) => {
          btn.addEventListener('click', () => {
            const command = btn.getAttribute('data-command');
            document.getElementById('commandInput').value = command;
            document.getElementById('commandInput').focus();
          });
        });

        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
          resetBtn.addEventListener('click', () => {
            if (
              confirm(
                'Â¿EstÃ¡s seguro de reiniciar? PerderÃ¡s todo el progreso de esta pantalla.'
              )
            ) {
              consoleCtrl.resetAll();
              validator.reset();
              ui.showExerciseInstructions(
                SCREEN_EXERCISES.screen2[0],
                'exerciseInstructions'
              );
              ui.updateExerciseProgress(
                0,
                SCREEN_EXERCISES.screen2.length,
                'exerciseProgress'
              );
              ui.showNotification('ğŸ”„ Pantalla reiniciada', 'info');
            }
          });
        }

        const hintBtn = document.getElementById('hintBtn');
        if (hintBtn) {
          hintBtn.addEventListener('click', () => {
            const exercise = validator.getCurrentExercise();
            if (exercise) {
              ui.showNotification(`ğŸ’¡ ${exercise.hint}`, 'warning', 6000);
            }
          });
        }

        // Actualizar indicador en checkout
        const originalCheckout = graph.checkout.bind(graph);
        graph.checkout = function (branchName) {
          const result = originalCheckout(branchName);
          if (result) {
            const year =
              branchName === '2015'
                ? '2015'
                : branchName === 'main'
                ? '1985'
                : branchName;
            ui.updateBranchIndicator(`${branchName} (${year})`);
          }
          return result;
        };

        Logger.log('Pantalla 2 inicializada correctamente');
      });
    </script>
  </body>
</html>
